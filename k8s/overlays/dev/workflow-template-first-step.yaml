apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: first-step-workflow-template
  labels:
    tags.datadoghq.com/env: "dev"
spec:
  entrypoint: first-step-job
  templates:
    - name: first-step-job
      serviceAccountName: argocd
      container:
        resources:
          requests:
            cpu: 750m
            memory: 64Mi
          limits:
            cpu: 1000m
            memory: 64Mi
        restartPolicy: Never
        name: first-step-container
        image: asia-northeast1-docker.pkg.dev/planet-4f7c6/gke-argocd/first-step
        command:
          - "./first-batch"
      script:
        image: alpine:latest
        command: [sh]
        source: TZ=JST-9 date -d "@$(( $(date +%s) - 24 * 60 * 60 ))" "+%Y-%m-%d" > /tmp/previous_day.txt
      outputs:
        parameters:
          - name: previous_day
            valueFrom:
              path: /tmp/previous_day.txt